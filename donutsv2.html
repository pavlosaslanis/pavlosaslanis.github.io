
<!DOCTYPE html>
<html>
<head>
	
	<title>TEST LANS</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="stylesheet" href="src/Leaflet.DonutCluster.css">
    <script src="src/Leaflet.DonutCluster.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<!--    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>-->

<!--
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
-->
<!--
	<link rel="stylesheet" href="../dist/MarkerCluster.css" />
	<link rel="stylesheet" href="../dist/MarkerCluster.Default.css" />
	<script src="../dist/leaflet.markercluster-src.js"></script>
-->

<!--
   <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin="">
    
   </script>
-->
    
    
    
        <link rel="stylesheet" href="https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css">
    
    
        <script src="https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js"></script>
    
    
	
</head>
<body>



<div id="mapid" style="width: 1800px; height: 800px;"></div>
     <script src="src/Leaflet.DonutCluster.js"></script>
<script>

    
    
    
    
    
    
    
    
    
	var map = L.map('mapid').setView([63.30631276498364, 16.792338880530966], 5);	
	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoicGF2bG9zZ2lzIiwiYSI6ImNqOWo2dHp3ZjAxdDkzMXFwaTlzNjNxdDkifQ.GbdCGFAd2TfeRxdIOPEhVA', {
		maxZoom: 21,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
		tileSize: 512,
		zoomOffset: -1
	}).addTo(map);
	

    
    
function updateParams() {
    //
    var x = document.getElementById("myInput").value;
    var filter =  x ;
    alert(filter)
    //return WFSLayer.setParams({CQL_FILTER:filter});
    
}

    
var greyIcon = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});    


    
var group1 = L.layerGroup();     
    
window.onload = function(){ 
    
    document.getElementById("buttonFilter").addEventListener('click', function(event) {
    //map.removeLayer(WFSLayer); 
    var x = document.getElementById("myInput").value;
    //var filter = 'name = "' + x + '"';
    //theExpression = filter;
    console.log(x);	      
    
    var defaultParameters = {
    service: 'WFS',
    version: '1.0.0',
    request: 'GetFeature',
    typeName: 'split_shops:alla_tobak_shops',
    maxFeatures: 50,
    outputFormat: 'text/javascript',
    format_options: 'callback: getJson',
    cql_filter : document.getElementById("myInput").value,
    srsName:'EPSG:4326'
    }
    console.log(defaultParameters);

    var owsrootUrl = 'http://localhost:8081/geoserver/split_shops/ows';
    var parameters = L.Util.extend(defaultParameters);
    var URL = owsrootUrl + L.Util.getParamString(parameters);

    var WFSLayer = null;
    var ajax = $.ajax({
        url : URL,
        dataType : 'jsonp',
        jsonpCallback : 'getJson',
        success : function (response) {
            WFSLayer = L.geoJson(response, {
                style: function (feature) {
                    return {
                        stroke: true,
                        fillColor: '#FF0000',
                        fillOpacity: 0
                    };
                },
                onEachFeature: function (feature, layer) {
                    layer.setIcon(greyIcon)
                    popupOptions = {maxWidth: 200};
                    layer.bindPopup(feature.properties.name +"," + feature.properties.customer_class_filtered
                        ,popupOptions);
                }
            }).addTo(group1);
        }
    });
        group1.addTo(map)
   }); 
};
    
//markerClusters_test.addTo(map)
//////////////////
//var orangeIcon = new L.Icon({
//    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',
//    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
//    iconSize: [25, 41],
//    iconAnchor: [12, 41],
//    popupAnchor: [1, -34],
//    shadowSize: [41, 41]
//}); 
//    
//    
  
    
    
    

    
    
    
var groups = L.layerGroup(); 
var markers_array = []
/////////////////////////////////////////
// Load the Data in the beggining...
///////////////////////////////////////////

    
    
//var markerstest = new L.MarkerClusterGroup({ 
//     // Comment the green circles....
////    iconCreateFunction: function (cluster) {
////        var markerschild = cluster.getAllChildMarkers();
////        var html = '<div class="circle">' + markerschild.length + '</div>';
////        return L.divIcon({ html: html, className: 'mycluster', iconSize: L.point(32, 32) });
////    },
//    spiderfyOnMaxZoom: true, showCoverageOnHover: true, zoomToBoundsOnClick: true,
//   disableClusteringAtZoom: 10, 
//});
 

var markerstest = L.DonutCluster({
    chunkedLoading: true
}, {
    key: 'value'
    , arcColorDict: {
                    1: 'yellow',
                    2: 'silver',
                    3: 'orange',
                    4: 'black',
                    5: 'violet',
                
                }
})
  
    
var defaultParameters = {
    service: 'WFS',
    version: '1.0.0',
    request: 'GetFeature',
    typeName: 'split_shops_pardy_v2:shops_classified_reclass_pardy_v2',
    maxFeatures: 3500,
    outputFormat: 'text/javascript',
    format_options: 'callback: getJson',
    //cql_filter : "name ='Lundgrens Tobak Aktiebolag'",
    srsName:'EPSG:4326'

};

var owsrootUrl = 'http://localhost:8081/geoserver/split_shops_pardy_v2/ows';
var parameters = L.Util.extend(defaultParameters);
var URL = owsrootUrl + L.Util.getParamString(parameters);

var WFSLayer = null;
var ajax = $.ajax({
    url : URL,
    dataType : 'jsonp',
    jsonpCallback : 'getJson',
    success : function (response) {
        WFSLayer = L.geoJson(response, {
            style: function (feature) {
                return {
                    stroke: true,
                    fillColor: '#FF0000',
                    fillOpacity: 0
                };
            },
            onEachFeature: function (feature, layer) {
                popupOptions = {maxWidth: 200};
                layer.bindPopup(feature.properties.name+"," + feature.properties.customer_class_filtered
                    ,popupOptions);
                
//                    var marker3333 = L.marker(feature.properties.latitude, feature.properties.longtitude, {
//                        customer_class_filtered: feature.properties.customer_class_filtered
//                    });    
                var customer_class_filtered_test = feature.properties.customer_class_filtered;
                console.log(customer_class_filtered_test);
//                value : customer_class_filtered_test;
                var mark = L.marker(L.latLng(feature.properties.latitude,feature.properties.longtitude),{
                    value : feature.properties.customer_class_filtered
                });
                mark.bindPopup(feature.properties.name+"," + feature.properties.customer_class_filtered
                    ,popupOptions);
//                console.log(mark);
                markerstest.addLayer(mark);
            },
            
            
        })//.addTo(markerstest)//.addLayer(markers_array);
        
    }
});

markerstest.addTo(map);
console.log("markerstest",markerstest)
    
    
//markerstest.on('clustermouseover', function (e) {
//    console.log('Number of markers: ' + e.layer.getAllChildMarkers());
//    markers_array.push(e.layer.getAllChildMarkers().feature)
//});
 

    
    
//markerstest.eachLayer(function(layer){
//  console.log(layer.getAllChildMarkers())
//});   

//

//console.log(WFSLayer)
    
//markerstest.addLayer(markers_array)   
//var layerControl = L.control.groupedLayers(baseLayers, groupedOverlays, {
//    collapsed: isCollapsed,
//    position:"bottomright"
//}).addTo(map);



//////////////////

    
    
    // Generate random points......
    
//function mockPoints(total) {
//    var types = ['1', '2', '3', '4'],
//        x = [0, 120],
//        y = [30, 60],
//        result = [],
//        i = 0;
//    while (i++ < total) {
//        var lat = Math.random() * (y[1] - y[0]) + y[0],
//            long = Math.random() * (x[1] - x[0]) + x[0],
//            type = types[Math.floor(Math.random() * types.length)];
//        result.push([lat, long, type])
//    }
//    return result;
//}
//    
    
//            var map = L.map('map').setView([40.0484, 116.286976], 3);
//            L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);

var markersdonut = L.DonutCluster({
    chunkedLoading: true
}, {
    key: 'customer_class_filtered'
    , arcColorDict: {
                    1: 'green',
                    2: 'orange',
                    3: 'red',
                    4: 'grey',
//                    5: 'orange'
                }
})

// var markers = L.markerClusterGroup();
//var points = mockPoints(1000);
//
//    
//console.log("points",points)
////console.log(markerstest)
////console.log(ajax)
////console.log(ajax === Array)
////
//for (var i = 0; i < points.length; i++) {
//    var a = points[i];
//    var customer_class_filtered = a[2];
//    var marker = L.marker(L.latLng(a[0], a[1]), {
//        customer_class_filtered: customer_class_filtered
//    });
//
//
//    marker.bindPopup(customer_class_filtered);
//    markersdonut.addLayer(marker);
//}

//markerstest.addTo(markersdonut);    

//var test = new Array(markerstest)
//markers.addLayer(markerstest);
//console.log(test === String)


//map.addLayer(markerstest);
//    
    
//for (var i = 0; i < points.length; i++) {
//    var a = points[i];
//    var customer_class_filtered = a[2];
//    var marker = L.marker(L.latLng(a[0], a[1]), {
//        customer_class_filtered: customer_class_filtered
//    });    
    
//markerstest.on( function (e) {
//	console.log('Number of markers: ' + e.layer.getAllChildMarkers().length);
//});   
    
    
    
var test_array = new Array(markerstest);    
console.log(test_array)
 
    
markerstest.addLayer(markersdonut)    
markersdonut.addTo(map);
console.log("markersdonut",markersdonut);
        
</script>
    
   
<form>
    Search For:<br>
    <input type="text" id="myInput" placeholder='name = "Lundgrens Tobak Aktiebolag"' value="name = 'Lundgrens Tobak Aktiebolag'" >
    <input type="button" id="buttonFilter" value="Filter" onclick="updateParams()">
</form>

    
    
    
    
    
    
    
    
    
    
    
    
    
</body>
</html>
